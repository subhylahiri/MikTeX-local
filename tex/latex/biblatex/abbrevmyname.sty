%%  Abbreviate a specific name in citations.
%%  Useful for slides etc.
%%
%%  Put \myname{Smith} in your preamble.
%%
%% Requires packages: biblatex, xstring, xpatch
%%
%%
%% See https://tex.stackexchange.com/a/73246/147422
%================================================================================
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{abbrevmyname}[2018/5/13 abbreviate a specific name (SL)]
%--------------------------------------------------------------------------------
\@ifpackageloaded{biblatex}{}{\PackageWarning{abbrevmyname}{This package requires biblatex}}
%================================================================================
\RequirePackage{xstring}
\RequirePackage{xpatch}
%--------------------------------------------------------------------------------
\providecommand{\highlightname}{}
\providecommand{\myname}[1]{\renewcommand{\highlightname}{#1}}
\providebibmacro{ifhighlightname}[3]{\IfSubStr{#1}{\highlightname}{#2}{#3}}%
\xpretonameformat{labelname}{\bgroup}%
   {}{\PackageWarning{abbrevmyname}{Failed to patch bib name format labelname!}}
%\xpatchnameformat{labelname}{\usebibmacro{name:andothers}}{\egroup\usebibmacro{name:andothers}}%
%   {}{\PackageWarning{abbrevmyname}{Failed to patch bib name format labelname!}}
%\xpretonameformat{labelname}%
%  {\usebibmacro{ifhighlightname}{\namepartprefix\namepartgiven\namepartfamily\namepartsuffix}%
%    {\usebibmacro{name:given-family}%
%        {\namepartfamilyi}%
%        {\namepartgiveni}%
%        {\namepartprefixi}%
%        {\namepartsuffixi}}}%
%  {}{\PackageWarning{abbrevmyname}{Failed to patch bib name format labelname!}}
\DeclareNameFormat{labelname}{%
  \usebibmacro{ifhighlightname}{\namepartgiven\namepartprefix\namepartfamily\namepartsuffix}%
    {\usebibmacro{name:family}%
        {\namepartgiveni\namepartprefix\namepartfamilyi\namepartsuffixi}%
        {\namepartgiveni}%
        {\relax}%
        {\namepartsuffixi}}%
    {%
  \ifcase\value{uniquename}%
    \usebibmacro{name:family}
      {\namepartfamily}
      {\namepartgiven}
      {\namepartprefix}
      {\namepartsuffix}%
  \or
    \ifuseprefix
      {\usebibmacro{name:given-family}
        {\namepartfamily}
        {\namepartgiveni}
        {\namepartprefix}
        {\namepartsuffixi}}
      {\usebibmacro{name:given-family}
        {\namepartfamily}
        {\namepartgiveni}
        {\namepartprefixi}
        {\namepartsuffixi}}%
  \or
    \usebibmacro{name:given-family}
      {\namepartfamily}
      {\namepartgiven}
      {\namepartprefix}
      {\namepartsuffix}%
  \fi
    }  \usebibmacro{name:andothers}
}%
%================================================================================

%================================================================================
\endinput
