%%  My standard preamble.
%%
%% Requires packages: amsmath, amssymb, amsthm, mathtools, appendix, natbib,
%%                    xcolor, ifpdf, hyperref, cleveref, etoolbox, caption,
%%                    graphicx, epstopdf, sl-panels, sl-defs
%%
%% This package must be declared **after** biblatex, if it is used.
%%
%%
%% History: 2018/03/17 v1.0      (SL) copied from sl_preamble.tex
%--------------------------------------------------------------------------------
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{sl-preamble}[2018/3/17 v1.0 standard preamble (SL)]
%--------------------------------------------------------------------------------
\makeatletter
%--------------------------------------------------------------------------------
\RequirePackage{etoolbox}
\newtoggle{sl@draft}
\newtoggle{sl@tables}
\newtoggle{sl@theorem}
\newtoggle{sl@graphics}
\newtoggle{sl@svg}
\newtoggle{sl@def}
\newtoggle{sl@eqcref}
%--------------------------------------------------------------------------------
\DeclareOption{final}{\togglefalse{sl@draft}}
\DeclareOption{draft}{\toggletrue{sl@draft}}
\DeclareOption{notheorem}{\togglefalse{sl@theorem}}
\DeclareOption{theorem}{\toggletrue{sl@theorem}}
\DeclareOption{nodefs}{\togglefalse{sl@def}}
\DeclareOption{defs}{\toggletrue{sl@def}}
\DeclareOption{xr}{\RequirePackage{xr-hyper}}
\DeclareOption{notables}{\togglefalse{sl@tables}}
\DeclareOption{tables}{\toggletrue{sl@tables}}
\DeclareOption{nographics}{\togglefalse{sl@graphics}}
\DeclareOption{graphics}{\toggletrue{sl@graphics}}
\DeclareOption{nosvg}{\togglefalse{sl@svg}}
\DeclareOption{svg}{\toggletrue{sl@svg}}
\DeclareOption{noeqcref}{\togglefalse{sl@eqcref}}
\DeclareOption{eqcref}{\toggletrue{sl@eqcref}}
\DeclareOption{nonameinlink}{}
\DeclareOption{capitalise}{\PassOptionsToPackage{capitalise}{cleveref}}
\DeclareOption{nameinlink}{\PassOptionsToPackage{nameinlink}{cleveref}}
\DeclareOption{noabbrev}{\PassOptionsToPackage{noabbrev}{cleveref}}
\DeclareOption{hidelinks}{\PassOptionsToPackage{hidelinks}{hyperref}}
\DeclareOption{borderlinks}{\PassOptionsToPackage{%
                                linkbordercolor=red!20!white,%
                                citebordercolor=green!20!white,%
                                filebordercolor=cyan!20!white,%
                                urlbordercolor=cyan!20!white,%
                                runbordercolor=teal!20!white}{hyperref}}
\DeclareOption{colorlinks}{\PassOptionsToPackage{%
                                colorlinks=true,%
                                linkcolor=red!30!black,%
                                citecolor=green!50!black,%
                                filecolor=blue!70!black,%
                                urlcolor=blue!70!black}{hyperref}}

\DeclareOption*{\PassOptionsToPackage{\CurrentOption}{sl-defs}}

\ExecuteOptions{final,defs,borderlinks,notables,nographics,svg,eqcref}
\ProcessOptions
%--------------------------------------------------------------------------------

%% Preamble:
%\usepackage{a4wide}
%\usepackage{ams} for finding documentation only
\RequirePackage{amsmath,amssymb}
\iftoggle{sl@theorem}{\RequirePackage{amsthm}}{}
\iftoggle{sl@def}{\RequirePackage{sl-defs}}{}
\RequirePackage{mathtools}
\@ifpackageloaded{biblatex}{}{\RequirePackage[sort&compress,numbers]{natbib}}
\RequirePackage[toc,page,title,titletoc]{appendix}
\AtBeginEnvironment{appendices}{\phantomsection}
\RequirePackage{xcolor}
\RequirePackage{ifpdf}
%
\ifpdf
    \RequirePackage[pdftex]{hyperref}
    \hypersetup{bookmarksopen,bookmarksnumbered,pdfstartview=FitH}
\else
    \RequirePackage[hypertex]{hyperref}
\fi
%
\iftoggle{sl@tables}{%
    \RequirePackage{array}
    \RequirePackage{multirow}
    \RequirePackage{booktabs}
    \newcolumntype{C}{>{$}c<{$}}
    \newcolumntype{L}{>{$}l<{$}}
    \newcolumntype{R}{>{$}r<{$}}
    \newcolumntype{A}{R@{\,}L}
    \newcommand{\colhead}[1]{\multicolumn{2}{l}{#1}}
    \newcommand{\colheadc}[1]{\multicolumn{2}{c}{#1}}
    \newcommand{\colheadr}[1]{\multicolumn{2}{r}{#1}}
}{}
\iftoggle{sl@graphics}{%
    \RequirePackage[hypcap]{caption}%links to figures
    \RequirePackage{graphicx}
    %\RequirePackage{graphics} for finding documentation only
    %\RequirePackage{pgf}
    %
    \pdfsuppresswarningpagegroup=1
    \RequirePackage{epstopdf}
    \epstopdfsetup{update,suffix=-generated}
    %
    \iftoggle{sl@svg}{%
        \IfFileExists{"C:/Program Files/Inkscape/inkscape.exe"}{%
            \newcommand{\inkscapedir}{C:/Progra\string~1/Inkscape/}%
        }{}
        \IfFileExists{"/Applications/Inkscape.app/Contents/Resources/bin/inkscape"}{%
            \newcommand{\inkscapedir}{/Applications/Inkscape.app/Contents/Resources/bin/}%
        }{}
        \providecommand{\inkscapedir}{}
        %
        \ifpdf
            \epstopdfDeclareGraphicsRule{.svg}{pdf}{.pdf}{%
                "\inkscapedir inkscape" -f #1 -C -A \OutputFile}
        \fi
    }{}
    %
    \ifpdf
    \else
        \DeclareGraphicsRule{.png}{eps}{.bb}{}
    \fi
    %\RequirePackage{sl-panels}
}{}
\iftoggle{sl@draft}{\RequirePackage[notref,notcite,color]{showkeys}}{}
% ----------------------------------------------------------------
\RequirePackage{cleveref}
\iftoggle{sl@eqcref}{\RequirePackage{eqcref}}{}
\AtBeginEnvironment{appendices}{%
    \crefalias{section}{appendix}
    \crefalias{subsection}{subappendix}
    \crefalias{subsubsection}{subsubappendix}
}
% ----------------------------------------------------------------
\iftoggle{sl@theorem}{%
\newtheoremstyle{sldefinition}%
  {3pt}%space above
  {3pt}%space below
  {}%body font
  {}%indent amount
  {\bfseries}%theorem head font
  {}%theorem head punctuation
  {\newline}%space after head
  {\thmname{#1}\thmnumber{ #2}:{\bfseries\thmnote{ #3}}}%head spec
\newtheoremstyle{slplain}%
  {3pt}%space above
  {3pt}%space below
  {}%body font
  {}%indent amount
  {\bfseries}%theorem head font
  {}%theorem head punctuation
  {\newline}%space after head
  {\thmname{#1}\thmnumber{ #2}{\bfseries\thmnote{ (#3)}}: }%head spec
%
\theoremstyle{slplain}
\newtheorem{thm}{Theorem}
\newtheorem{cor}[thm]{Corollary}
\newtheorem{lem}[thm]{Lemma}
%
\theoremstyle{sldefinition}
\newtheorem{defn}{Definition}
%
\theoremstyle{remark}
\newtheorem*{notn}{Notation}
\newtheorem*{rem}{Remark}
}{}
%\iftoggle{sl@draft}{}{\RequirePackage{autonum}}
% ----------------------------------------------------------------
\vfuzz2pt % Don't report over-full v-boxes if over-edge is small
\hfuzz2pt % Don't report over-full h-boxes if over-edge is small
% ----------------------------------------------------------------
\makeatother
\endinput
